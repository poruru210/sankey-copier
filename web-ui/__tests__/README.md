# Phase 3: Sidebar Filter UX - E2E Tests

## Overview

These Playwright tests verify the sidebar filtering functionality **without requiring actual MT4/MT5 environment**. API responses and WebSocket connections are mocked to simulate real behavior.

## Test Coverage

### 1. Sidebar Filter Tests
- ✅ Display sidebar with all master accounts
- ✅ Show connection counts for each master
- ✅ Filter accounts when clicking a master
- ✅ Clear filter functionality
- ✅ Display online/offline status indicators
- ✅ Update sidebar selection on click
- ✅ Display total connection count

### 2. Keyboard Navigation Tests
- ✅ Navigate with Arrow Down key
- ✅ Navigate with Arrow Up key
- ✅ Select master with Enter key
- ✅ Select master with Space key

### 3. Mobile Drawer Tests (viewport < 1024px)
- ✅ Show hamburger menu button
- ✅ Open drawer on click
- ✅ Close drawer when clicking backdrop
- ✅ Close drawer after selecting a master

## Setup

### 1. Install Dependencies

```bash
cd web-ui
npm install
```

This will install Playwright and all required dependencies.

### 2. Install Playwright Browsers (First Time Only)

```bash
npx playwright install
```

## Running Tests

### Run All Tests (Headless)

```bash
npm run test:e2e
```

### Run Tests with UI (Interactive Mode)

```bash
npm run test:e2e:ui
```

This opens the Playwright Test UI where you can:
- See all tests in a tree view
- Run individual tests
- See live preview of the browser
- Debug tests step by step

### Run Tests in Headed Mode (Browser Visible)

```bash
npm run test:e2e:headed
```

Useful for debugging test failures.

### View Test Report

```bash
npm run test:e2e:report
```

Opens the HTML report generated by Playwright.

## Test Structure

```
__tests__/
├── mocks/
│   └── testData.ts          # Mock data for connections and settings
├── sidebar-filter.spec.ts   # Main test file
└── README.md                # This file
```

## Mock Data

The tests use mock data defined in `mocks/testData.ts`:

- **3 Master Accounts**:
  - Trading Account A (FxPro, Online, 2 connections)
  - Trading Account B (OANDA, Offline, 1 connection)
  - Trading Account C (XM, Online, 1 connection)

- **4 Slave Accounts**:
  - Copy Account 1-4 (various brokers)

- **4 Copy Settings**:
  - Various configurations with different lot multipliers, filters, etc.

## API Mocking

Tests mock the following endpoints:

- `GET /api/connections` - Returns list of EA connections
- `GET /api/settings` - Returns list of copy settings
- WebSocket connection - Mocked to prevent connection errors

This allows tests to run without a running backend server (Rust server).

## Test Results

All tests should pass if the sidebar filtering functionality is working correctly. Any failures indicate:

1. **UI rendering issues** - Elements not visible or incorrectly rendered
2. **Filter logic bugs** - Accounts not filtered properly
3. **Keyboard navigation issues** - Keys not working as expected
4. **Mobile responsive issues** - Drawer not working on mobile viewports

## Continuous Integration

These tests can be run in CI/CD pipelines:

```bash
# CI environment
CI=true npm run test:e2e
```

In CI mode:
- Tests run serially (not in parallel)
- Retries failed tests 2 times
- Generates HTML report

## Debugging Failed Tests

1. **Check screenshots**: Playwright captures screenshots on failure
   - Located in `test-results/`

2. **Check videos**: Videos are retained on failure
   - Located in `test-results/`

3. **Check traces**: Traces are captured on retry
   - Open with `npx playwright show-trace <trace-file>`

4. **Run in headed mode**: See the browser as tests run
   ```bash
   npm run test:e2e:headed
   ```

5. **Use debug mode**: Step through tests
   ```bash
   npx playwright test --debug
   ```

## Browser Support

Tests run on:
- ✅ Chromium (Chrome/Edge)
- ✅ Firefox
- ✅ WebKit (Safari)
- ✅ Mobile Chrome (Pixel 5)
- ✅ Mobile Safari (iPhone 12)

## Notes

- Tests assume the app runs on `http://localhost:5173`
- Dev server is automatically started by Playwright if not running
- Tests use mocked data, so **no actual MT4/MT5 environment is needed**
- Animation timeouts are included to wait for transitions (300-500ms)

## Future Enhancements

Potential additions:
- [ ] Visual regression testing (screenshot comparison)
- [ ] Performance testing (measure filter response time)
- [ ] Accessibility testing (aXe-core integration)
- [ ] Test settings dialog interactions
- [ ] Test error scenarios (API failures)
