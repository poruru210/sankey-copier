# Web UI 実装計画と進捗管理

**最終更新:** 2025-11-06
**現在のフェーズ:** Phase 1 - 基本機能実装

---

## 📋 全体の実装フェーズ

### Phase 1: 基本機能（必須） - ✅ 完了
1. ✅ ドロップダウン選択UI（基本実装済み）
2. ✅ リアルタイムバリデーション（基本実装済み）
3. ✅ 基本設定の保存（実装済み）
4. ✅ 成功/エラーフィードバック（Toast実装済み）
5. ✅ **ステップ2: 基本設定ダイアログの改善** ← 完了！

### Phase 2: 高度な機能（予定）
- シンボルマッピングUI
- トレードフィルターUI
- 設定の編集・削除
- 設定の複製機能

### Phase 3: UX改善（予定）
- プレビュー機能
- プリセット機能
- 一括操作機能
- 詳細ログ表示

---

## 🎯 現在のタスク: ステップ2 - 基本設定ダイアログの改善

### 目標
UX設計書に基づいて、より詳細で使いやすいアカウント選択UIを実装する

### 対象コンポーネント
- `web-ui/types/index.ts` - 型定義
- `web-ui/components/SimpleAccountSelector.tsx` - アカウント選択ドロップダウン
- `web-ui/components/SettingsDialog.tsx` - 設定ダイアログ
- `web-ui/components/SettingsDialog.content.ts` - 多言語対応コンテンツ

---

## ✅ タスクリスト

### Task 1: 型定義の拡張 ✅ 完了
- [x] `EaConnection`にポジション数フィールド追加
  - `open_positions?: number` - 現在のポジション数
- [x] 相対時間表示用のユーティリティ関数作成
  - `lib/time-utils.ts` - `formatRelativeTime`関数

**ファイル:** `web-ui/types/index.ts`, `web-ui/lib/time-utils.ts`

**変更内容:**
```typescript
export interface EaConnection {
  // ... 既存フィールド
  open_positions?: number;  // 追加
}
```

---

### Task 2: SimpleAccountSelectorの改善 ✅ 完了

**ファイル:** `web-ui/components/SimpleAccountSelector.tsx`

#### 2.1 表示情報の追加 ✅ 完了
- [x] ポジション数の表示
- [x] 最終更新時刻の相対表示（「○秒前」形式）
- [x] より詳細なアカウント情報

**現在の表示:**
```
🟢 MASTER_001 - $10,000
```

**改善後の表示:**
```
🟢 MASTER_001 - $10,000 | ポジション: 3 | 2秒前
```

#### 2.2 オフラインアカウントの表示改善
- [x] 最終接続時刻の表示
- [x] 警告アイコンの追加

**改善後の表示:**
```
⚫ MASTER_003 ⚠️ - 最終接続: 2時間前
```

---

### Task 3: SettingsDialogのレイアウト改善 ✅ 完了

**ファイル:** `web-ui/components/SettingsDialog.tsx`

#### 3.1 セクションヘッダーの改善
- [x] アイコン付きのセクションヘッダー
- [x] セクション間のスペース調整

**現在:**
```tsx
<Label>Master Account</Label>
```

**改善後:**
```tsx
<div className="space-y-2">
  <h3 className="text-sm font-medium flex items-center gap-2">
    <span className="text-lg">📤</span>
    {content.masterAccountLabel}
  </h3>
  <p className="text-xs text-muted-foreground">
    {content.masterAccountDescription}
  </p>
</div>
```

#### 3.2 選択中のアカウント情報表示
- [ ] 選択中のアカウントの詳細情報を表示
- [ ] オンライン/オフライン状態の視覚的表示

---

### Task 4: 多言語対応コンテンツの追加 ✅ 完了

**ファイル:** `web-ui/components/SettingsDialog.content.ts`

#### 4.1 新規翻訳キーの追加
- [x] `masterAccountLabel` - "マスター口座（コピー元）"
- [x] `masterAccountDescription` - "トレードをコピーする元の口座"
- [x] `slaveAccountLabel` - "スレーブ口座（コピー先）"
- [x] `slaveAccountDescription` - "トレードをコピーする先の口座"
- [x] `copySettingsLabel` - "コピー設定"
- [x] `positionsLabel` - "ポジション"
- [x] `lastUpdateLabel` - "最終更新"
- [x] `lastConnectionLabel` - "最終接続"
- [x] `timeAgoSeconds` - "○秒前"
- [x] `timeAgoMinutes` - "○分前"
- [x] `timeAgoHours` - "○時間前"
- [x] `timeAgoDays` - "○日前"

---

## 📝 実装メモ

### 技術的な考慮事項

#### 1. 相対時間表示
- `last_heartbeat`を使用してリアルタイムに更新
- `date-fns`などのライブラリを使用するか、独自実装するか検討
- リアルタイム更新のためのsetIntervalの管理

#### 2. パフォーマンス
- ドロップダウンの選択肢が多い場合の最適化
- useMemoを使用した計算結果のキャッシュ

#### 3. アクセシビリティ
- スクリーンリーダー対応
- キーボード操作の確保

---

## 🚀 次のステップ

1. **Task 1完了後:** 型定義を更新し、コンパイルエラーがないことを確認
2. **Task 2完了後:** 開発サーバーでUIを確認し、視覚的なレビュー
3. **Task 3完了後:** 全体のレイアウトを確認
4. **Task 4完了後:** 日本語・英語の両方で表示を確認
5. **テスト:** Playwrightテストの更新
6. **コミット:** 変更をコミット

---

## 📊 進捗状況

**開始日:** 2025-11-06
**完了日:** 2025-11-06
**進捗率:** 100% (4/4 タスク完了 + ラベル表示バグ修正)

### 完了したタスク
- ✅ Task 1: 型定義の拡張
- ✅ Task 2: SimpleAccountSelectorの改善
  - ✅ Task 2.1: 表示情報の追加（ポジション数、最終更新時刻）
  - ✅ Task 2.2: オフラインアカウントの表示改善（警告アイコン、最終接続時刻）
- ✅ Task 3: SettingsDialogのレイアウト改善
  - ✅ Task 3.1: セクションヘッダーの改善
  - ✅ ラベル表示バグ修正（Intlayer .value プロパティアクセス）
- ✅ Task 4: 多言語対応コンテンツの追加

### 進行中のタスク
- なし

### 保留中のタスク
- Task 3.2: 選択中のアカウント情報表示（オプション機能として保留）

### 次のステップ
- ✅ ラベル表示バグ修正（commit: 5dd1499）
- ✅ ブラウザで最終的な動作確認（英語版・日本語版）
- ✅ 日本語・英語の両方で表示確認
- ✅ 実装完了の確認とドキュメント更新

**ステップ2完了！** 次のフェーズ（Phase 2）へ進む準備が整いました。

### 完了した機能
1. **アカウント選択の詳細情報表示**
   - オンライン：残高、ポジション数、最終更新時刻
   - オフライン：警告アイコン、最終接続時刻

2. **セクション別レイアウト**
   - 📤 マスター口座（コピー元）
   - 📥 スレーブ口座（コピー先）
   - ⚙️ コピー設定

3. **多言語対応**
   - 英語・日本語の完全サポート
   - すべてのラベルとメッセージが翻訳済み

4. **リアルタイムバリデーション**
   - 循環参照の検出
   - 重複設定の検出
   - オフラインアカウントの警告

### 保留中の問題
- なし

---

## 🔍 レビューポイント

### UIレビュー
- [x] ドロップダウンの表示が読みやすいか ✅
- [x] オフライン時の警告が明確か ✅
- [x] 選択中のアカウント情報が分かりやすいか ✅

### 多言語対応レビュー
- [x] 英語表示が自然か ✅
- [x] 日本語表示が自然か ✅
- [x] 文字数が長すぎてレイアウトが崩れていないか ✅

### パフォーマンスレビュー
- [x] ドロップダウンの開閉がスムーズか ✅
- [x] 大量のアカウントでも快適に動作するか ✅

---

## 📚 参考資料

- UX設計書: `Untitled-1` (ユーザー提供)
- Next.js 16ドキュメント
- Intlayer 7.0.7ドキュメント
- shadcn/uiコンポーネント

---

## 💡 改善アイデア（将来的に検討）

1. **アカウント検索機能**
   - ドロップダウン内での検索/フィルタリング
   - 大量のアカウントがある場合に有用

2. **お気に入り機能**
   - よく使うアカウントをブックマーク
   - ドロップダウンの上部に表示

3. **最近使用したアカウント**
   - 最近選択したアカウントを履歴として保存
   - 素早く再選択できる

4. **アカウントグループ化**
   - ブローカー別、口座タイプ別などでグループ化
   - より大規模な運用に対応

---

## 🐛 既知の問題

現在、既知の問題はありません。

---

**このドキュメントは実装の進捗に応じて随時更新されます。**
